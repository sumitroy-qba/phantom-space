<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Startup Risk Assessment</title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        body {
            padding-bottom: 2rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-lg);
        }

        .stat-card {
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin: var(--spacing-sm) 0;
        }

        .stat-label {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .quick-actions {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
            margin-top: var(--spacing-lg);
        }

        .action-btn {
            flex: 1;
            min-width: 200px;
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container navbar-content">
            <div class="navbar-brand">Startup Assessment Platform</div>
            <ul class="navbar-nav">
                <li><a href="/admin/dashboard.html" class="navbar-link">Dashboard</a></li>
                <li><a href="/admin/startup-users.html" class="navbar-link">Startup Users</a></li>
                <li><a href="/admin/submissions.html" class="navbar-link">Submissions</a></li>
                <li><a href="/admin/compare.html" class="navbar-link">Compare & Rank</a></li>
                <li><a href="/admin/survey-builder.html" class="navbar-link">Survey Builder</a></li>
                <li><span class="navbar-link" id="username-display"></span></li>
                <li><button class="btn btn-sm btn-secondary" id="logout-btn">Logout</button></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <div class="fade-in">
            <h1>Admin Dashboard</h1>
            <p class="text-secondary">Welcome to the Startup Assessment Platform</p>
        </div>

        <!-- Statistics -->
        <div class="dashboard-grid fade-in">
            <div class="stat-card">
                <div class="stat-label">Total Startup Users</div>
                <div class="stat-value" id="stat-users">-</div>
                <div class="stat-label">Registered in system</div>
            </div>

            <div class="stat-card" style="background: var(--gradient-accent);">
                <div class="stat-label">Submissions</div>
                <div class="stat-value" id="stat-submissions">-</div>
                <div class="stat-label">Completed assessments</div>
            </div>

            <div class="stat-card" style="background: var(--gradient-success);">
                <div class="stat-label">Active Drafts</div>
                <div class="stat-value" id="stat-drafts">-</div>
                <div class="stat-label">In progress</div>
            </div>

            <div class="stat-card"
                style="background: linear-gradient(135deg, hsl(199, 89%, 48%) 0%, hsl(199, 89%, 38%) 100%);">
                <div class="stat-label">Pending Invites</div>
                <div class="stat-value" id="stat-pending">-</div>
                <div class="stat-label">Awaiting response</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="mt-4 fade-in">
            <h2>Quick Actions</h2>
            <div class="quick-actions">
                <a href="/admin/startup-users.html?action=create" class="btn btn-primary action-btn">
                    ‚ûï Create Startup User
                </a>
                <a href="/admin/submissions.html" class="btn btn-secondary action-btn">
                    üìä View All Submissions
                </a>
                <a href="/admin/compare.html" class="btn btn-secondary action-btn">
                    üîç Compare Startups
                </a>
                <a href="/admin/survey-builder.html" class="btn btn-secondary action-btn">
                    ‚öôÔ∏è Edit Survey Questions
                </a>
            </div>
        </div>

        <!-- Recent Submissions -->
        <div class="mt-4 fade-in">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Recent Submissions</h3>
                </div>
                <div class="card-body">
                    <div id="recent-submissions-container">
                        <div class="text-center" style="padding: 2rem;">
                            <div class="spinner" style="margin: 0 auto;"></div>
                            <p class="mt-2">Loading submissions...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check authentication
        fetch('/admin/api/check-session')
            .then(res => res.json())
            .then(data => {
                if (!data.authenticated) {
                    window.location.href = '/admin/login.html';
                } else {
                    document.getElementById('username-display').textContent = data.username;
                    loadDashboardData();
                }
            });

        // Logout
        document.getElementById('logout-btn').addEventListener('click', async () => {
            await fetch('/admin/api/logout', { method: 'POST' });
            window.location.href = '/admin/login.html';
        });

        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Load startup users
                const usersRes = await fetch('/admin/api/startup-users');
                const users = await usersRes.json();

                document.getElementById('stat-users').textContent = users.length;

                const pending = users.filter(u => u.status === 'Invited').length;
                document.getElementById('stat-pending').textContent = pending;

                const drafts = users.filter(u => u.draft_count > 0 && u.submission_count === 0).length;
                document.getElementById('stat-drafts').textContent = drafts;

                // Load submissions
                const submissionsRes = await fetch('/admin/api/submissions');
                const submissions = await submissionsRes.json();

                document.getElementById('stat-submissions').textContent = submissions.length || users.filter(u => u.submission_count > 0).length;

                // Display recent submissions
                displayRecentSubmissions(users.filter(u => u.submission_count > 0).slice(0, 5));
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        function displayRecentSubmissions(users) {
            const container = document.getElementById('recent-submissions-container');

            if (users.length === 0) {
                container.innerHTML = '<p class="text-center text-secondary">No submissions yet</p>';
                return;
            }

            const table = `
        <table class="table">
          <thead>
            <tr>
              <th>Startup Name</th>
              <th>Email</th>
              <th>Status</th>
              <th>Last Activity</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${users.map(user => `
              <tr>
                <td><strong>${user.startup_name || 'N/A'}</strong></td>
                <td>${user.email}</td>
                <td><span class="badge badge-success">${user.status}</span></td>
                <td>${new Date(user.last_login_at || user.created_at).toLocaleDateString()}</td>
                <td>
                  <a href="/admin/submissions.html?user=${user.id}" class="btn btn-sm btn-primary">View Details</a>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;

            container.innerHTML = table;
        }
    </script>
</body>

</html>